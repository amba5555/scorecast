<!DOCTYPE html>
<!-- Chosen Palette: Tiered Feedback Palette (Blue for Excellent, Green for Good, Teal for Pass, Yellow for Encouragement) -->
<!-- Application Structure Plan: The two-stage structure is maintained. The 'Results View' is further refined to create a stronger visual hierarchy. It now features a large, central 'Overall Score' block as the primary focal point, containing the numeric score and a larger, more prominent progress gauge. This is flanked by the top-level status card (now with 4 tiers of feedback) and the secondary sub-score cards at the bottom. This structure immediately draws the user's eye to the most critical number (the total score) while providing layered context through the status message and detailed breakdown, enhancing clarity and impact. -->
<!-- Visualization & Content Choices: Report Info: Student scores with a tiered evaluation logic (Excellent >=8, Good >=6, Pass >=5). Goal: To deliver nuanced, hierarchical feedback that emphasizes the overall achievement while providing clear context. Viz/Presentation Method: 1) The 'Status Card' is enhanced with 4 conditional states (text, icons: üéâ, üëç, ‚úÖ, üìñ) for nuanced feedback. 2) The 'Overall Score' is now the hero element with a massive font size. 3) The 'Progress Gauge' is made physically larger (thicker) and uses tiered colors to reflect the achievement level. 4) Sub-score cards are visually de-emphasized with smaller text to support the hierarchy. Interaction: The entire results view's theme (colors, icons, text) dynamically adapts to one of the four performance tiers upon data fetch. Justification: This hierarchical design is more effective as it guides the user's attention from the most important summary (overall score) to the qualitative feedback (status) and finally to the details (sub-scores), creating a more intuitive and impactful user experience. Library/Method: Vanilla JS, Tailwind CSS. Chart.js removed as it's no longer used. -->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #F8F9FA;
        }
        .btn {
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .btn:active {
            transform: scale(0.98);
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236B7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: .65em auto;
            padding-right: 2.5rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="min-h-screen flex flex-col items-center justify-center p-4">

        <!-- View 1: Lookup Form -->
        <div id="lookup-view" class="w-full max-w-md">
            <div class="bg-white p-8 md:p-10 rounded-xl shadow-sm border border-gray-200">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ</h1>
                    <p class="text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="subjectSelect" class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <select id="subjectSelect" class="w-full text-lg p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none transition">
                            <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ --</option>
                            <option value="scibio">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û</option>
                            <option value="bio1">‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ 1</option>
                            <option value="bio3">‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ 3</option>
                            <option value="bio5">‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ 5</option>
                            <option value="sci2-1">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°. 2/1</option>
                            <option value="sci2-2">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°. 2/2</option>
                            <option value="sci2-3">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°. 2/3</option>
                        </select>
                    </div>
                    <div>
                        <label for="studentIdInput" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
                        <input type="text" id="studentIdInput" class="w-full text-center text-lg p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none transition" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                    </div>
                    <button id="checkScoreBtn" class="w-full py-3 px-4 bg-blue-600 text-white font-bold text-lg rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 btn !mt-6">
                        ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    </button>
                </div>
                <div id="errorMessage" class="mt-4 text-center text-red-600 font-semibold"></div>
            </div>
        </div>

        <!-- View 2: Results Dashboard -->
        <div id="results-view" class="w-full max-w-lg hidden">
             <div class="bg-white p-6 md:p-8 rounded-xl shadow-sm border border-gray-200">
                <div class="text-center mb-4">
                    <p id="subjectName" class="text-xl font-semibold text-gray-500"></p>
                    <p class="text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ‡∏Ç‡∏≠‡∏á</p>
                    <h2 id="studentName" class="text-3xl font-bold text-gray-800 mt-1"></h2>
                </div>

                <div id="status-card" class="p-4 rounded-lg text-center mb-6 transition-colors duration-500">
                    <p id="status-icon" class="text-3xl"></p>
                    <p id="status-text" class="text-xl font-bold mt-1"></p>
                    <p id="status-desc" class="text-sm"></p>
                </div>
                
                <div class="text-center my-6">
                    <p class="text-lg font-semibold text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</p>
                    <p id="overallScoreText" class="text-6xl font-extrabold text-gray-800"></p>
                    
                    <div class="w-full bg-gray-200 rounded-full h-8 relative mt-3">
                        <div id="score-bar" class="h-8 rounded-full transition-all duration-1000 ease-out"></div>
                        <div class="absolute top-0 bottom-0 border-l-2 border-gray-400 border-dashed" style="left: 50%;">
                             <span class="absolute -bottom-6 text-xs font-semibold text-gray-500" style="left: -18px;">‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-2 gap-4">
                    <div class="p-4 bg-gray-100 rounded-lg text-center border">
                        <p class="text-md font-semibold text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏ô‡∏±‡∏¢</p>
                        <p id="objScore" class="text-2xl font-bold text-gray-800 mt-1"></p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg text-center border">
                        <p class="text-md font-semibold text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏±‡∏ï‡∏ô‡∏±‡∏¢</p>
                        <p id="subScore" class="text-2xl font-bold text-gray-800 mt-1"></p>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button id="searchAgainBtn" class="py-2 px-6 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 btn">
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw9Vxwpcki4Kloctyw9Gyp9qPvzpMtBRKb8ZYRh59aznA_YajlL0GucgDpQdpR0-hNexw/exec';

        // Views
        const lookupView = document.getElementById('lookup-view');
        const resultsView = document.getElementById('results-view');
        
        // Lookup Elements
        const studentIdInput = document.getElementById('studentIdInput');
        const subjectSelect = document.getElementById('subjectSelect');
        const checkScoreBtn = document.getElementById('checkScoreBtn');
        const errorMessage = document.getElementById('errorMessage');
        const searchAgainBtn = document.getElementById('searchAgainBtn');

        // Results Elements
        const studentNameEl = document.getElementById('studentName');
        const subjectNameEl = document.getElementById('subjectName');
        const statusCard = document.getElementById('status-card');
        const statusIcon = document.getElementById('status-icon');
        const statusText = document.getElementById('status-text');
        const statusDesc = document.getElementById('status-desc');
        const overallScoreText = document.getElementById('overallScoreText');
        const scoreBar = document.getElementById('score-bar');
        const objScoreEl = document.getElementById('objScore');
        const subScoreEl = document.getElementById('subScore');

        checkScoreBtn.addEventListener('click', handleFetchData);
        studentIdInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') handleFetchData(); });
        searchAgainBtn.addEventListener('click', resetView);

        function resetView() {
            resultsView.classList.add('hidden');
            lookupView.classList.remove('hidden');
            studentIdInput.value = '';
            subjectSelect.value = '';
            errorMessage.textContent = '';
        }

        function handleFetchData() {
            const studentId = studentIdInput.value.trim();
            const selectedSubject = subjectSelect.value;

            if (!selectedSubject) {
                errorMessage.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤';
                return;
            }
            if (!studentId) {
                errorMessage.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß';
                return;
            }
            fetchData(studentId, selectedSubject);
        }

        async function fetchData(studentId, subject) {
            checkScoreBtn.disabled = true;
            checkScoreBtn.innerHTML = `<div class="flex items-center justify-center"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>`;
            errorMessage.textContent = '';

            const url = `${SCRIPT_URL}?id=${studentId}&sheetName=${encodeURIComponent(subject)}`;

            try {
                const response = await fetch(url);
                const result = await response.json();
                
                // --- NEW ERROR HANDLING LOGIC ---
                if (result.error) {
                    if (result.error === 'ID_NOT_FOUND') {
                        displayError('‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    } else if (result.error === 'SCORE_MISSING') {
                        displayError('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô');
                    } else {
                        // Handle other potential errors from the script
                        displayError(result.error);
                    }
                } else if (result.data) {
                    displayResult(result.data);
                } else {
                    // Fallback for an unexpected response structure
                    displayError('‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            } catch (error) {
                displayError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
            } finally {
                checkScoreBtn.disabled = false;
                checkScoreBtn.innerHTML = '‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô';
            }
        }

        function displayError(message) {
            errorMessage.textContent = message;
        }

        function displayResult(data) {
            const MAX_OBJ = 20, MAX_SUB = 5, MAX_OVERALL = 10;
            const EXCELLENT_SCORE = 8, GOOD_SCORE = 6, PASS_SCORE = 5;

            const objScore = Number(data.obj) || 0;
            const subScore = Number(data.sub) || 0;
            const overallScore = Number(data.overall) || 0;
            
            const selectedOption = subjectSelect.options[subjectSelect.selectedIndex];
            const subjectDisplayName = selectedOption.text;

            // Update Names
            studentNameEl.textContent = `${data.name || ''} ${data.last || ''}`;
            subjectNameEl.textContent = `‡∏ß‡∏¥‡∏ä‡∏≤: ${subjectDisplayName}`;

            // Tiered Feedback Logic
            let statusInfo = {};
            if (overallScore >= EXCELLENT_SCORE) {
                statusInfo = { cardClass: 'bg-blue-100 text-blue-800 border-blue-200', barClass: 'bg-blue-500', icon: 'üéâ', text: '‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!', desc: '‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢' };
            } else if (overallScore >= GOOD_SCORE) {
                statusInfo = { cardClass: 'bg-green-100 text-green-800 border-green-200', barClass: 'bg-green-500', icon: 'üëç', text: '‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å!', desc: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡πÄ‡∏•‡∏¢ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞' };
            } else if (overallScore >= PASS_SCORE) {
                statusInfo = { cardClass: 'bg-teal-100 text-teal-800 border-teal-200', barClass: 'bg-teal-500', icon: '‚úÖ', text: '‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß', desc: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏Å‡∏±‡∏ô' };
            } else {
                statusInfo = { cardClass: 'bg-yellow-100 text-yellow-800 border-yellow-200', barClass: 'bg-yellow-500', icon: 'üìñ', text: '‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞', desc: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏µ‡∏Å‡πÅ‡∏Ñ‡πà ${PASS_SCORE - overallScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πá‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏π‡πâ‡πÜ!` };
            }

            // Apply Status
            statusCard.className = `p-4 rounded-lg text-center mb-6 transition-colors duration-500 ${statusInfo.cardClass}`;
            statusIcon.textContent = statusInfo.icon;
            statusText.textContent = statusInfo.text;
            statusDesc.textContent = statusInfo.desc;

            // Update Overall Score Gauge
            const percentage = (overallScore / MAX_OVERALL) * 100;
            overallScoreText.innerHTML = `${overallScore}<span class="text-2xl text-gray-400">/${MAX_OVERALL}</span>`;
            scoreBar.style.width = `${percentage}%`;
            scoreBar.className = `h-8 rounded-full transition-all duration-1000 ease-out ${statusInfo.barClass}`;

            // Update Sub Scores
            objScoreEl.innerHTML = `${objScore}<span class="text-lg text-gray-400">/${MAX_OBJ}</span>`;
            subScoreEl.innerHTML = `${subScore}<span class="text-lg text-gray-400">/${MAX_SUB}</span>`;
            
            // Show results
            lookupView.classList.add('hidden');
            resultsView.classList.remove('hidden');
        }
    </script>
</body>
</html>
